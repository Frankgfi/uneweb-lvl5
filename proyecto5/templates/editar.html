{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Persona</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <!-- Incluir jQuery desde CDN -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>
    <div class="formulario-container">
        <h1>Editar Persona</h1>
        <form method="post" id="personaForm">
            {% csrf_token %}
            {{ form.non_field_errors }}
            
            <table class="form-table">
                <tr>
                    <td><label for="id_DNI">DNI:</label></td>
                    <td>{{ form.DNI }}</td>
                    <td><div class="error-message" id="dni-error"></div></td>
                </tr>
                
                <tr>
                    <td><label for="id_nombres">Nombres:</label></td>
                    <td>{{ form.nombres }}</td>
                    <td><div class="error-message" id="nombres-error"></div></td>
                </tr>
                
                <tr>
                    <td><label for="id_apellidos">Apellidos:</label></td>
                    <td>{{ form.apellidos }}</td>
                    <td><div class="error-message" id="apellidos-error"></div></td>
                </tr>
                
                <tr>
                    <td><label for="id_sexo">Sexo:</label></td>
                    <td>{{ form.sexo }}</td>
                    <td><div class="error-message" id="sexo-error"></div></td>
                </tr>
                
                <tr>
                    <td><label for="id_fecha_nacimiento">Fecha de nacimiento:</label></td>
                    <td>{{ form.fecha_nacimiento }}</td>
                    <td><div class="error-message" id="fecha-error"></div></td>
                </tr>
                
                <tr>
                    <td><label for="id_direccion">Dirección:</label></td>
                    <td>{{ form.direccion }}</td>
                    <td><div class="error-message" id="direccion-error"></div></td>
                </tr>
                
                <tr>
                    <td><label for="id_telefono">Teléfono:</label></td>
                    <td>{{ form.telefono }}</td>
                    <td><div class="error-message" id="telefono-error"></div></td>
                </tr>
                
                <tr>
                    <td><label for="id_correo">Correo electrónico:</label></td>
                    <td>{{ form.correo }}</td>
                    <td><div class="error-message" id="correo-error"></div></td>
                </tr>
            </table>
            
            <div class="botones-container">
                <button type="submit" class="btn-guardar" id="submitBtn">Guardar Cambios</button>
                <a href="{% url 'lista_personas' %}" class="btn-volver">Cancelar</a>
            </div>
        </form>
    </div>

    <!-- Script de validación -->
    <script>
        $(document).ready(function() {
            // Validacion expresiones
            const regexTelefono = /^[0-9]{12}$/; // Exactamente 12 dígitos
            const regexCorreo = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            
            // mensaje de error
            function mostrarError(campoId, mensaje) {
                $(`#${campoId}-error`).text(mensaje).show();
                $(`#${campoId}`).addClass('field-error').removeClass('field-success');
            }
            
            function mostrarExito(campoId) {
                $(`#${campoId}-error`).hide();
                $(`#${campoId}`).removeClass('field-error').addClass('field-success');
            }
            
            // Validación para teléfono
            $('#id_telefono').on('input blur', function() {
                const telefono = $(this).val().trim();
                
                if (telefono === '') {
                    mostrarError('telefono', 'El teléfono es obligatorio');
                } else if (!regexTelefono.test(telefono)) {
                    mostrarError('telefono', 'El teléfono debe tener exactamente 12 dígitos numéricos');
                } else {
                    mostrarExito('telefono');
                }
            });
            
            // Validación para correo
            $('#id_correo').on('input blur', function() {
                const correo = $(this).val().trim();
                
                if (correo === '') {
                    mostrarError('correo', 'El correo electrónico es obligatorio');
                } else if (!regexCorreo.test(correo)) {
                    mostrarError('correo', 'Ingrese un correo electrónico válido (ejemplo: usuario@dominio.com)');
                } else {
                    mostrarExito('correo');
                }
            });
            
            // Validación del formulario completo antes de enviar
            $('#personaForm').on('submit', function(e) {
                let formularioValido = true;
                
                // Validar teléfono
                const telefono = $('#id_telefono').val().trim();
                if (telefono === '' || !regexTelefono.test(telefono)) {
                    mostrarError('telefono', 'El teléfono debe tener exactamente 12 dígitos numéricos');
                    formularioValido = false;
                }
                
                // Validar correo
                const correo = $('#id_correo').val().trim();
                if (correo === '' || !regexCorreo.test(correo)) {
                    mostrarError('correo', 'Ingrese un correo electrónico válido');
                    formularioValido = false;
                }
                
                // Si hay errores, prevenir el envío
                if (!formularioValido) {
                    e.preventDefault();
                    alert('Por favor, corrija los errores antes de enviar el formulario.');
                    return false;
                }
                
                // Si todo está bien, mostrar mensaje de éxito
                alert('Formulario válido. Guardando cambios...');
            });
            
            // Validación adicional para otros campos obligatorios
            $('#id_DNI, #id_nombres, #id_apellidos').on('blur', function() {
                const valor = $(this).val().trim();
                const campoId = $(this).attr('id').replace('id_', '');
                
                if (valor === '') {
                    mostrarError(campoId, 'Este campo es obligatorio');
                } else {
                    mostrarExito(campoId);
                }
            });
        });
    </script>
</body>
</html>